<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Global Printer Dash</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <style>
        /* (Use the CSS from your original code here) */
        body { font-family: 'Segoe UI', Arial; background-color: #f4f4f9; padding: 20px; }
        .section { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; border: none; width: 100%; }
        .on { background-color: #4CAF50; color: white; }
        .off { background-color: #f44336; color: white; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>
    <h2>GLOBAL 3D PRINTER CONTROL</h2>
    <div id="connection-status" style="color: orange;">Connecting to Cloud...</div>

    <div class="section">
        <h3>MASTER POWER</h3>
        <p>Status: <span id="relay9_status">OFF</span></p>
        <button id="relay9_btn" class="btn on" onclick="handleRelayAction(9)">TURN MASTER ON</button>
    </div>

    <div class="section">
        <h3>PRINTER CHANNELS</h3>
        <div class="grid" id="relay-container"></div>
    </div>

    <script>
        const MQTT_HOST = "143fa294384e4a2fa42c7bfe8a7ebd1d.s1.eu.hivemq.cloud";
        const MQTT_PORT = 8884; // WebSocket Port
        const MQTT_USER = "hivemq.webclient.1769879772484";
        const MQTT_PASS = "e9GHjk0b18hiCBAD%<$!";
        const CLIENT_ID = "web_user_" + Math.random().toString(16).substr(2, 8);

        const client = new Paho.MQTT.Client("wss://" + MQTT_HOST + ":" + MQTT_PORT + "/mqtt", CLIENT_ID);

        client.connect({
            useSSL: true,
            userName: MQTT_USER,
            password: MQTT_PASS,
            onSuccess: () => {
                document.getElementById('connection-status').innerText = "ONLINE (Connected to Cloud)";
                document.getElementById('connection-status').style.color = "green";
                client.subscribe("/printer_01/status");
            }
        });

        client.onMessageArrived = (message) => {
            const data = JSON.parse(message.payloadString);
            data.relays.forEach((state, i) => updateUI(i + 1, state));
            updateUI(9, data.master);
        };

        function sendCmd(id, state) {
            const msg = new Paho.MQTT.Message(JSON.stringify({relay: id, state: state}));
            msg.destinationName = "/printer_01/commands";
            client.send(msg);
        }

        // Initialize UI Buttons
        const container = document.getElementById('relay-container');
        const labels = ["Printer 1", "Printer 2", "Printer 3", "Printer 4", "Free 1", "Free 2", "LED", "Spare"];
        for (let i = 1; i <= 8; i++) {
            container.innerHTML += `<div class="relay-card" style="border:1px solid #ccc; padding:10px;">
                <small>${labels[i-1]}</small><br>
                <span id="relay${i}_status">OFF</span><br>
                <button id="relay${i}_btn" class="btn on" onclick="handleRelayAction(${i})">ON</button>
            </div>`;
        }

        function handleRelayAction(id) {
            const isCurrentlyOn = document.getElementById(`relay${id}_status`).innerText === "ON";
            sendCmd(id, isCurrentlyOn ? 0 : 1);
        }

        function updateUI(id, state) {
            const statusEl = document.getElementById(`relay${id}_status`);
            const btnEl = document.getElementById(`relay${id}_btn`);
            if (state == 1) {
                statusEl.innerText = "ON"; statusEl.style.color = "green";
                btnEl.innerText = "TURN OFF"; btnEl.className = "btn off";
            } else {
                statusEl.innerText = "OFF"; statusEl.style.color = "red";
                btnEl.innerText = "TURN ON"; btnEl.className = "btn on";
            }
        }
    </script>
</body>
</html>