<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Mezza Control</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- LOGIN OVERLAY -->
  <div id="login-overlay">
    <div class="login-box">
      <h2>SYSTEM LOGIN</h2>
      <input type="text" id="mqtt-user" class="input-field" placeholder="Username">
      <input type="password" id="mqtt-pass" class="input-field" placeholder="Password">
      <hr style="border:0; border-top:1px solid #444; margin:15px 0;">
      <input type="text" id="device-name" class="input-field" placeholder="Device Name (e.g. Red's Phone)">
      <button class="action-btn" onclick="connectSystem()">CONNECT</button>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" style="display:none;">

    <header class="header">
      <strong>SMART MEZZA CONTROL</strong>
      <div style="font-size:11px;">
        <span id="display-name" style="color:#aaa; margin-right:10px;">Unknown Device</span>
        <button onclick="doLogout()" style="background:none; border:1px solid #666; color:#ccc; padding:5px 10px; cursor:pointer;">EXIT</button>
      </div>
    </header>

    <div class="container">

      <!-- LEFT PANEL -->
      <div class="sidebar">

        <div class="card">
          <h3>MASTER POWER (ID: 9)</h3>
          <div style="text-align:center; margin-bottom:10px;">
            <span id="led-9" class="led"></span> <b>System Bus</b>
          </div>
          <button id="btn-9" class="btn btn-on" onclick="handleClick(9)">TURN ON</button>
        </div>

        <div id="panel-lock" class="card disabled">
          <h3>CONTROL PANEL</h3>
          <div class="grid-2" id="relay-grid"></div>
        </div>

      </div>

      <!-- MAIN CONTENT -->
      <div class="main-content">

        <!-- CAMERA -->
        <div class="card">
          <h3>LIVE FEED</h3>
          <div class="camera-box">
            <img id="cam-stream" src="" style="display:none;" alt="Live Feed"
              onload="this.style.display='block'; document.getElementById('cam-msg').style.display='none';">
            <div id="cam-msg" style="position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; color:#555;">
              <span style="font-size:16px; font-weight:bold;">WAITING FOR LINK...</span>
              <span style="font-size:10px;">Click ⚙️ to set Cloudflare URL</span>
            </div>
          </div>
        </div>

        <!-- POWER MONITOR -->
        <div class="card">
          <h3>POWER MONITOR</h3>
          <div class="pzem-grid">
            <div><div id="val-v" class="pzem-val">0</div><div class="pzem-label">VOLTS</div></div>
            <div><div id="val-a" class="pzem-val">0.00</div><div class="pzem-label">AMPS</div></div>
            <div><div id="val-w" class="pzem-val">0</div><div class="pzem-label">WATTS</div></div>
            <div><div id="val-wh" class="pzem-val">0.00</div><div class="pzem-label">Wh</div></div>
          </div>
        </div>

        <!-- ACTIVITY LOG -->
        <div class="card" style="flex:1;">
          <h3>ACTIVITY LOG</h3>
          <div class="log-list">
            <table class="log-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>By</th>
                  <th>Action</th>
                  <th>Target</th>
                </tr>
              </thead>
              <tbody id="log-body"></tbody>
            </table>
          </div>
        </div>

      </div>
    </div>

    <!-- SETTINGS BUTTON -->
    <button id="config-btn" onclick="openModal('config-modal')">⚙️</button>
    <button id="help-btn" onclick="openModal('tutorial-modal')">?</button>

    <!-- FOOTER -->
    <footer>
      <span id="clock">--:--:--</span>
      <span>Temp: <b id="val-temp">--</b>°C</span>
      <span>Humi: <b id="val-humi">--</b>%</span>
    </footer>

  </div>

  <!-- CONFIG MODAL -->
  <div id="config-modal" class="modal-overlay">
    <div class="modal-box">
      <h3>⚙️ CAMERA CONFIG</h3>
      <input type="text" id="stream-input" class="input-field"
        placeholder="https://your-tunnel.trycloudflare.com">
      <div style="display:flex; gap:10px; margin-top:15px;">
        <button class="action-btn" onclick="saveConfig()">SAVE</button>
        <button class="action-btn" style="background:#555;" onclick="closeModal('config-modal')">CANCEL</button>
      </div>
    </div>
  </div>

  <!-- CONFIRM MODAL -->
  <div id="confirm-modal" class="modal-overlay">
    <div class="modal-box">
      <h3 style="color:red;">⚠️ CONFIRM ACTION</h3>
      <p id="confirm-msg">Type CONFIRM to proceed.</p>
      <input type="text" id="confirm-input" class="input-field"
        style="text-align:center;" placeholder="Type CONFIRM">
      <div style="display:flex; gap:10px; margin-top:15px;">
        <button class="btn btn-off" onclick="executeOff()">CONFIRM</button>
        <button class="btn btn-on" onclick="closeModal('confirm-modal')">CANCEL</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="config.js"></script>
  <script src="app.js"></script>

</body>
</html>
